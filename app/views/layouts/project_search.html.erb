<%- content_for :header do -%>
<!-- <section class="container" id="projects-header">
  <nav id="sectionnav">
    <ol class="clearfix">
      <li><a href="#">Choose a Cause</a></li>
      <li><a href="#">Our Partners</a></li>
      <li><a href="#">What is Proof of Impact?</a></li>
      <li><%= link_to "U:Powered", dt_upowered_path %></li>
    </ol>
  </nav>
</section> -->
<%- end -%>

<%= render :partial => 'layouts/shared/head' %>
<body id="projects" class="dark">
<%= render :partial => "layouts/shared/facebook_api" %>

<div class="wrapper">
<%= render :partial => 'layouts/shared/header' %>

<div id="maincontentarea" class="content prepend-top append-large-bottom">
  <% unless search_params_blank? %>
  <section class="container prepend-top">
    <%= render :partial => 'layouts/shared/flashes' %>
    <ul id="project-search-terms">
      <% search_records.each do |facet, record| %>
        <%= render :partial => "search_term", :locals => { :facet => facet, :record => record } %>
      <% end %>
      <li><%= link_to "| &nbsp; Clear all", dt_projects_path %></li>
    </ul>
  </section>
  <% end %>

  <div class="container prepend-top">
    <aside class="span-3" id="project-filters">
      <h2 class="plain border-bottom">Choose</h2>
      <%= render :partial => "search_text" %>
      <div class="project-filter">
        ACTIVE/COMPLETED
        <ul>
<% @facets[:project_status_id].sort_by{ |k,v| v }.reverse.each do |id,count| %>
			<li><%= link_to "#{ProjectStatus.find(id).name} (#{count})", project_search_add(:project_status_id, id) %></li>
<%- end -%>
        </ul>
      </div>
      <div class="project-filter">
        CAUSE/SECTOR
        <ul>
<% @facets[:sector_ids].reject{ |k,v| k == 0 }.sort_by{ |k,v| v }.reverse.each do |id,count| %>
			<li><%= link_to "#{Sector.find(id).name} (#{count})", project_search_add(:sector_ids, id) %></li>
<%- end -%>
        </ul>
      </div>
      <div class="project-filter">
        LOCATION
        <ul class="limit-height">
<% @facets[:country_id].sort_by{ |k,v| v }.reverse.each do |id,count| %>
			<li><%= link_to "#{Place.find(id).name} (#{count})", project_search_add(:country_id, id) %></li>
<%- end -%>
        </ul>
      </div>
      <div class="project-filter">
        PARTNER
        <ul class="limit-height">
<% @facets[:partner_id].sort_by{ |k,v| v }.reverse.each do |id,count| %>
			<li><%= link_to "#{Partner.find(id).name} (#{count})", project_search_add(:partner_id, id) %></li>
<%- end -%>
        </ul>
      </div>
      <div class="project-filter">
        TOTAL COST
        <ul>
<% [[0, 5000], [5001, 10000], [10001, 15000], [15001, 20000], [20001, 50000], [50001, 100000], [100001, 500000]].each do |range|
	cost_count = Project.search_count(:with => search_query.merge(:total_cost => (range.min..range.max)))
%>
            <li><%= link_to "#{number_to_currency(range.first, :precision => 0)} - #{number_to_currency(range.last, :precision => 0)} (#{cost_count})", project_search_add(:total_cost, range) %></li>
<% end %>
        </ul>
      </div>
    </aside>
    <article class="span-12">
      <%= content_tag(:h1, yield(:title), :class => "clearfix") if show_title? && content_for?(:title) %>

      <% unless search_params_blank? %>
      <div id="project-search-summary" class="border-bottom clearfix">
        <% form_tag dt_projects_url, :method => :get, :id => "project_search_tools" do %>
          Sort by: <%= select_tag :order, options_for_select([["Added", 'created_at'], ["Total Cost", 'total_cost'], ["Country", 'country_name'], ["Partner", 'partner_name']], params[:order]) %> &nbsp; 
          Display: <%= select_tag :per_page, options_for_select([ '18', '36', '54' ], params[:per_page]) %>
			<input type="hidden" name="keyword" value="<%= params[:keyword] %>">
			<input type="hidden" name="status" value="<%= params[:status] %>">
			<input type="hidden" name="sector" value="<%= params[:sector] %>">
			<input type="hidden" name="country" value="<%= params[:country] %>">
			<input type="hidden" name="partner" value="<%= params[:partner] %>">
			<input type="hidden" name="cost" value="<%= params[:cost] %>">
        <% end %>
        <%#= "#{@projects.total_entries} found" %> 
        <%= will_paginate %>
      </div>
      <% end %>
      
      <div id="fb-root"></div>
      <%= yield %>
    </article>
    <aside class="span-3 last">
      <div id="rail">
        <%= render :partial => 'layouts/shared/newsletter' %>

        <%= yield :sidebar %>
      </div>
    </aside>
  </div>
</div>

<%= render :partial => 'layouts/shared/footer' %>
</div>
<%= render :partial => 'layouts/shared/tail' %>
